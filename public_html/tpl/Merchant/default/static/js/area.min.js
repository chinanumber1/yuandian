/**
 * 省市区三级联动 plugin
 *
 * Copyright (c) 2014 萧峰 (biweb.cn)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.gnu.org/licenses/gpl.html
 *
 */
	
	var __alldiv = {
			0:['﻿同城', 0],
			1:['﻿北京', 0],
			21:['上海', 0],
			42:['天津', 0],
			62:['重庆', 0],
			104:['安徽', 0],
			227:['福建', 0],
			322:['甘肃', 0],
			423:['广东', 0],
			566:['广西', 0],
			690:['贵州', 0],
			788:['海南', 0],
			814:['河北', 0],
			998:['河南', 0],
			1176:['黑龙江', 0],
			1320:['湖北', 0],
			1436:['湖南', 0],
			1573:['吉林', 0],
			1643:['江苏', 0],
			1763:['江西', 0],
			1874:['辽宁', 0],
			1989:['内蒙古', 0],
			2103:['宁夏', 0],
			2130:['青海', 0],
			2182:['山东', 0],
			2340:['山西', 0],
			2471:['陕西', 0],
			2589:['四川', 0],
			2792:['西藏', 0],
			2873:['新疆', 0],
			2987:['云南', 0],
			3133:['浙江', 0],
			3235:['香港', 0],
			3239:['澳门', 0],
			3242:['台湾', 0]
	}

function getProvinces(spid,vp) {
	var sp = document.getElementById(spid);
	var length = 0;
	sp.options.length = 0;
	sp.options.add(new Option("选择省", ""));
	for (var key in __alldiv){
		if (key.indexOf('0000') == 2 || key == 500000){
			sp.options.add(new Option(__alldiv[key][0],key));
			if(key == vp) {
				length = sp.options.length-1
			}
		}
	}

	if (sp.options.length == 0) {
		sp.disabled = true;
		sp.options.add(new Option("", "000000"));
	}else {
		sp.disabled = false;
	}
	sp.options[length].selected = true;
}

function getCitys(scid, spid,vc) {
	var sc = document.getElementById(scid);
	var length = 0;
	sc.options.length = 0;

	var sp = document.getElementById(spid);
	var pv = sp.options[sp.selectedIndex].value;
	sc.options.add(new Option("选择市", ""));
	for (var key in __alldiv){
		if(pv == __alldiv[key][1]){
			sc.options.add(new Option(__alldiv[key][0],key));
			if(key == vc) {
				length = sc.options.length-1
			}
		}
	}

	if (sc.options.length == 1) {
		sc.parentNode.style.display = 'none';
	}else {
		sc.parentNode.style.display = '';
	}
	sc.options[length].selected = true;
}

function getAreas(said, scid,va) {
	var sa = document.getElementById(said);
	var length = 0;
	sa.options.length = 0;

	var sc = document.getElementById(scid);
	var cv = sc.options[sc.selectedIndex].value;
	sa.options.add(new Option("选择区", ""));
	for (var key in __alldiv){
		if(cv == __alldiv[key][1]){
			sa.options.add(new Option(__alldiv[key][0],key));
			if(key == va) {
				length = sa.options.length-1
			}
		}
	}

	if (sa.options.length == 1) {
		sa.parentNode.style.display = 'none';
	}else {
		sa.parentNode.style.display = '';
	}
	sa.options[length].selected = true;
}

function chgProvinces(sp, sc, sa) {
	getCitys(sc, sp);
	if(typeof(sa) != 'undefined') getAreas(sa, sc);
}

function chgCitys(sc, sa) {
	getAreas(sa, sc);
}

function AreaCtrl(strP,strC,strA){
	this.value="";
	this.randomNum = parseInt(Math.random()*100000000);
	this.level = arguments.length;
	var onchgProvincesStr = "";
	var onchgCityStr = "";
	var vp = "";
	var vc = "";
	var va = "";
	if(this.level==2){
		onchgProvincesStr = "onchange=chgProvinces('prov"+this.randomNum+"','city"+this.randomNum+"')";
	}
	if(this.level==3){
		onchgProvincesStr = "onchange=chgProvinces('prov"+this.randomNum+"','city"+this.randomNum+"','area"+this.randomNum+"')";
		onchgCityStr = "onchange=chgCitys('city"+this.randomNum+"','area"+this.randomNum+"')";
	}
	this.html = '<span>'+strP+'<select name="Province" id="prov'+this.randomNum+'" '+onchgProvincesStr+' ></select></span>';
	if (this.level>1){this.html += '<span>'+strC+'<select name="City" id="city'+this.randomNum+'" '+onchgCityStr+' ></select></span>';}
	if (this.level>2){this.html += '<span>'+strA+'<select name="Area" id="area'+this.randomNum+'"></select></span>';}

	this.write = function(){
		document.write(this.html);
	};
	this.loadData = function(){
		if(this.value != ''){
			if (this.value.indexOf('0000') == 2){
				vp = this.value;
			}else if(this.value.indexOf('00') == 4){
				vp = this.value.substring(0,2)+'0000';
				vc = this.value;
			}else{
				vp = this.value.substring(0,2)+'0000';
				vc = this.value.substring(0,4)+'00';
				va = this.value;
			}
		}
		sp = 'prov'+this.randomNum;
		if(this.level>=2) 	sc = 'city'+this.randomNum;
		if(this.level==3) 	sa = 'area'+this.randomNum;
		getProvinces(sp,vp);
		if(typeof(sc) != 'undefined') getCitys(sc, sp,vc);
		if(typeof(sa) != 'undefined') getAreas(sa, sc,va);
	};
}

